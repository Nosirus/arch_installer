set_mirrorlist(){
  #local countries_code
  #local country_name
  
	OPTION=n
	while [[ "$OPTION" == n ]]; do
		print_title 'MIRRORLIST'
		print_info "This option is a guide to selecting and configuring your mirrors, and a listing of current available mirrors."

  		local countries_code=("AU" "AT" "BY" "BE" "BR" "BG" "CA" "CL" "CN" "CO" "CZ" "DK" "EE" "FI" "FR" "DE" "GR" "HK" "HU" "ID" "IN" "IR" "IE" "IL" "IT" "JP" "KZ" "KR" "LV" "LU" "MK" "NL" "NC" "NZ" "NO" "PL" "PT" "RO" "RU" "RS" "SG" "SK" "ZA" "ES" "LK" "SE" "CH" "TW" "TR" "UA" "GB" "US" "UZ" "VN")
  		local country_name=("Australia" "Austria" "Belarus" "Belgium" "Brazil" "Bulgaria" "Canada" "Chile" "China" "Colombia" "Czech Republic" "Denmark" "Estonia" "Finland" "France" "Germany" "Greece" "Hong Kong" "Hungary" "Indonesia" "India" "Iran" "Ireland" "Israel" "Italy" "Japan" "Kazakhstan" "Korea" "Latvia" "Luxembourg" "Macedonia" "Netherlands" "New Caledonia" "New Zealand" "Norway" "Poland" "Portugal" "Romania" "Russia" "Serbia" "Singapore" "Slovakia" "South Africa" "Spain" "Sri Lanka" "Sweden" "Switzerland" "Taiwan" "Turkey" "Ukraine" "United Kingdom" "United States" "Uzbekistan" "Viet Nam")

		#echo "Select your country:"
		select opt in "${country_name[@]}"; do
			if contains_element "${opt}" "${country_name[@]}"; then
				COUNTRY_NAME="$opt"
				#COUNTRY_CODE=${countries_code[$(( $REPLY - 1 ))]}
				COUNTRY_CODE=${countries_code[REPLY - 1]}

				#COUNTRY_CODE=$(($REPLY - 1))
				break
			else
				invalid_option
			fi
		done
		confirm_yes "Confirm Mirrorlist ($COUNTRY_NAME)"
done
}
#}}}

configure_mirrorlist(){
	ask_default_option "$COUNTRY_NAME" set_mirrorlist
	update_option 'COUNTRY_NAME'
	update_option 'COUNTRY_CODE'
	
	url="https://www.archlinux.org/mirrorlist/?country=${COUNTRY_CODE}&use_mirror_status=on"

	tmpfile=$(mktemp --suffix=-mirrorlist)

	# Get latest mirror list and save to tmpfile
	curl -so ${tmpfile} ${url}
	sed -i 's/^#Server/Server/g' ${tmpfile}

	# Backup and replace current mirrorlist file (if new file is non-zero)
	if [[ -s ${tmpfile} ]]; then
		{ echo " Backing up the original mirrorlist..."
		mv -i /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.orig; } &&
		{ echo " Rotating the new list into place..."
		mv -i ${tmpfile} /etc/pacman.d/mirrorlist; }
	else
		echo " Unable to update, could not download list."
	fi
	# better repo should go first
	install_package 'pacman-contrib'
	cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.tmp
	rankmirrors /etc/pacman.d/mirrorlist.tmp > /etc/pacman.d/mirrorlist
	rm /etc/pacman.d/mirrorlist.tmp
	# allow global read access (required for non-root yaourt execution)
	chmod +r /etc/pacman.d/mirrorlist
	$EDITOR /etc/pacman.d/mirrorlist

	enter_to_continue
}
#}}}
